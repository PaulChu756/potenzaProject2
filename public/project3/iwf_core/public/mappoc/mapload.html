<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?libraries=drawing&key=AIzaSyBO0QnQyN0yGuTRGryCs40T3HRpep-j8tg&sensor=true">
    </script>
    <script src="json2.js" type="text/javascript"></script>

    <script type="text/javascript">
    var mapOverlays = new Array();

    function setMapData( mapObj, jsonString ){
        if( jsonString.length == 0 ){
            return false;
        }
        var inputData = JSON.parse( jsonString );
        if( inputData.zoom ){
            mapObj.setZoom( inputData.zoom );
        }else{
            mapObj.setZoom( 10 );
        }

        if( inputData.tilt ){
            mapObj.setTilt( inputData.tilt );
        }else{
            mapObj.setTilt( 0 );
        }

        if( inputData.mapTypeId ){
            mapObj.setMapTypeId( inputData.mapTypeId );
        }else{
            mapObj.setMapTypeId( "hybrid" );
        }

        if( inputData.center ){
            mapObj.setCenter( new google.maps.LatLng( inputData.center.lat, inputData.center.lng ) );
        }else{
            mapObj.setCenter( new google.maps.LatLng( 19.006295, 73.309021 ) );
        }



        var tmpOverlay, ovrOptions;
        var properties = new Array( 'fillColor', 'fillOpacity', 'strokeColor', 'strokeOpacity','strokeWeight', 'icon');
        for( var m = inputData.overlays.length-1; m >= 0; m-- ){
            ovrOptions = new Object();

            for( var x=properties.length; x>=0; x-- ){
                if( inputData.overlays[m][ properties[x] ] ){
                    ovrOptions[ properties[x] ] = inputData.overlays[m][ properties[x] ];
                }
            }


            if( inputData.overlays[m].type == "polygon" ){

                var tmpPaths = new Array();
                for( var n=0; n < inputData.overlays[m].paths.length; n++ ){

                    var tmpPath = new Array();
                    for( var p=0; p < inputData.overlays[m].paths[n].length; p++ ){
                        tmpPath.push(  new google.maps.LatLng( inputData.overlays[m].paths[n][p].lat, inputData.overlays[m].paths[n][p].lng ) );
                    }
                    tmpPaths.push( tmpPath );
                }
                ovrOptions.paths = tmpPaths;
                tmpOverlay = new google.maps.Polygon( ovrOptions );

            }else if( inputData.overlays[m].type == "polyline" ){

                var tmpPath = new Array();
                for( var p=0; p < inputData.overlays[m].path.length; p++ ){
                    tmpPath.push(  new google.maps.LatLng( inputData.overlays[m].path[p].lat, inputData.overlays[m].path[p].lng ) );
                }
                ovrOptions.path = tmpPath;
                tmpOverlay = new google.maps.Polyline( ovrOptions );

            }else if( inputData.overlays[m].type == "rectangle" ){
                var tmpBounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng( inputData.overlays[m].bounds.sw.lat, inputData.overlays[m].bounds.sw.lng ),
                    new google.maps.LatLng( inputData.overlays[m].bounds.ne.lat, inputData.overlays[m].bounds.ne.lng ) );
                ovrOptions.bounds = tmpBounds;
                tmpOverlay = new google.maps.Rectangle( ovrOptions );

            }else if( inputData.overlays[m].type == "circle" ){
                var cntr = new google.maps.LatLng( inputData.overlays[m].center.lat, inputData.overlays[m].center.lng );
                ovrOptions.center = cntr;
                ovrOptions.radius = inputData.overlays[m].radius;
                tmpOverlay = new google.maps.Circle( ovrOptions );

            }else if( inputData.overlays[m].type == "marker" ){
                var pos = new google.maps.LatLng( inputData.overlays[m].position.lat, inputData.overlays[m].position.lng );
                ovrOptions.position = pos;
                if( inputData.overlays[m].icon ){
                    ovrOptions.icon = inputData.overlays[m].icon ;
                }
                if( isEditable ){
                    ovrOptions.draggable =true;
                }
                tmpOverlay = new google.maps.Marker( ovrOptions );

            }
            tmpOverlay.type = inputData.overlays[m].type;
            tmpOverlay.setMap( mapObj );
            if( isEditable && inputData.overlays[m].type != "marker"){
                tmpOverlay.setEditable( true );

            }

            var uniqueid =  uniqid();
            tmpOverlay.uniqueid =  uniqueid;
            if( inputData.overlays[m].title ){
                tmpOverlay.title = inputData.overlays[m].title;
            }else{
                tmpOverlay.title = "";
            }

            if( inputData.overlays[m].content ){
                tmpOverlay.content = inputData.overlays[m].content;
            }else{
                tmpOverlay.content = "";
            }

            //attach the click listener to the overlay
            AttachClickListener( tmpOverlay );

            //save the overlay in the array
            mapOverlays.push( tmpOverlay );

        }

    }    

    

      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(30.114901, -91.995957),
          zoom: 22
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
        setMapData(map,'{"zoom":20,"tilt":45,"mapTypeId":"hybrid","center":{"lat":30.114971384063526,"lng":-91.99597510491083},"overlays":[{"type":"polygon","title":"","content":"","paths":[[{"lat":"30.11506913664093","lng":"-91.99614554643631"},{"lat":"30.11499038766343","lng":"-91.99611201882362"},{"lat":"30.114786952514326","lng":"-91.99597790837288"},{"lat":"30.114890310747274","lng":"-91.99578076601028"},{"lat":"30.115162650970145","lng":"-91.9959819316864"}]]}]}');

        /*
        var drawingManager = new google.maps.drawing.DrawingManager({
          drawingMode: google.maps.drawing.OverlayType.MARKER,
          drawingControl: true,
          drawingControlOptions: {
            position: google.maps.ControlPosition.TOP_CENTER,
            drawingModes: [
              google.maps.drawing.OverlayType.MARKER,
              google.maps.drawing.OverlayType.CIRCLE,
              google.maps.drawing.OverlayType.POLYGON,
              google.maps.drawing.OverlayType.POLYLINE,
              google.maps.drawing.OverlayType.RECTANGLE
            ]
          },
          markerOptions: {
            icon: 'http://www.example.com/icon.png'
          },
          circleOptions: {
            fillColor: '#ffff00',
            fillOpacity: 1,
            strokeWeight: 5,
            clickable: false,
            zIndex: 1,
            editable: true
          }
        }); 
        drawingManager.setMap(map);
        google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
            var uniqueid =  uniqid();
            event.overlay.uniqueid =  uniqueid;
            event.overlay.title = "";
            event.overlay.content = "";
            event.overlay.type = event.type;
            mapOverlays.push(event.overlay);
            mapToObject(map);
            var result = JSON.stringify( mapToObject(map) );
            document.getElementById('map-json').value = result;
            //console.log(event);
        });*/

      }

      google.maps.event.addDomListener(window, 'load', initialize);

      /* Helper functions */

    function uniqid(){
        var newDate = new Date;
        return newDate.getTime();
    }

    </script>
    <style>
        #map-canvas {
            width: 800px;
            height: 800px;
        }
    </style>
  </head>
  <body>
    <h1>Select Region</h1>
    <textarea id="map-json"></textarea>
    <div id="map-canvas"/>
  </body>
</html>